<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ¿ Hydroponics Assistant</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="text-success text-center mb-4">ðŸŒ¿ Hydroponics Assistant</h2>

  {% if error %}
  <div class="alert alert-danger text-center">{{ error }}</div>
  {% endif %}

  <form action="/predict" method="POST" class="card p-4 shadow">
    <div class="mb-3">
      <label class="form-label">Plant Name *</label>
      <input type="text" class="form-control" name="plant_name" placeholder="e.g., Lettuce" required>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Temperature (Â°C)</label>
        <input type="number" step="0.1" class="form-control" name="temperature">
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Humidity (%)</label>
        <input type="number" step="0.1" class="form-control" name="humidity">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">pH</label>
        <input type="number" step="0.1" class="form-control" name="ph">
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Nutrients (ppm)</label>
        <input type="number" step="0.1" class="form-control" name="nutrient">
      </div>
    </div>

    <button type="submit" class="btn btn-success w-100">Check Conditions</button>
  </form>

  <hr class="my-4">

  <!-- Chatbot -->
  <h4 class="text-center text-primary mb-3">ðŸ’¬ Chat Assistant</h4>
  <div class="card p-3 shadow-sm" id="chatbox" style="height: 300px; overflow-y: auto;"></div>

  <div class="input-group mt-3">
    <input id="chatInput" type="text" class="form-control" placeholder="Type your message... e.g., 'Lettuce'">
    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
async function sendMessage() {
  const input = document.getElementById("chatInput");
  const chatbox = document.getElementById("chatbox");

  const userMsg = input.value.trim();
  if (!userMsg) return;

  chatbox.innerHTML += `<div><b>You:</b> ${userMsg}</div>`;

  const response = await fetch("/chat", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({message: userMsg})
  });

  const data = await response.json();
  chatbox.innerHTML += `<div class="text-success"><b>Bot:</b> ${data.response || data.reply}</div>`;
  input.value = "";
  chatbox.scrollTop = chatbox.scrollHeight;
}
</script>
</body>
</html>
